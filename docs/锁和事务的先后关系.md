# 加锁一定要在事务开始之前!!!

也就是说, 一定要先进行加锁, 然后再开启事务

如果加锁在事务之后, 也就是先开启事务, 再进行加锁, 那么此时这里的锁实际上是失效的

因为此时事务在加锁的外面, 当锁被释放之后, 此时事务还没有被提交, 那么此时其他的线程就可以进来获取到这把锁, 但是由于此时事务没有提交, 那么此时其他线程(此时获取到锁)看到的数据都是脏数据, 起不到任何加锁的效果, 等于这把锁直接失效了

因此在编写分布式锁的aop切面的时候, 一定要注意: 保证加锁的aop实现, 一定要在事务开启之前, 由于这里事务我们也是通过声明式的注解@Transactional来声明的, 并且Spring的声明式事务的aop实现中, 没有控制aop的order等级, 因此这里我们自己编写的分布式锁的aop实现中, 就必须手动声明这个分布式锁的注解的优先级是最高的, 我们可以通过设置`@Order(0)`来实现